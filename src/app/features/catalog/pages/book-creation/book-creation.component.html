<div class="book-creation-page page-gutter section-block">

  <!-- Section title -->
  <app-section-title [title]="'Ajout d’un livre au catalogue'"></app-section-title>
  <a routerLink="/catalogue/management" class="back-link">← Retourner sur le catalogue</a>

  <form class="book-form" (ngSubmit)="onSubmit()" #f="ngForm">

    <!-- Titre + couverture + description -->
    <div class="form-grid cover-row">
      <!-- Titre -->
      <div class="form-field title-col">
        <label for="title">Titre du livre</label>
        <input id="title" type="text" name="title" [(ngModel)]="model.title" required />
      </div>

      <!-- Couverture -->
      <div class="form-field cover-col">
        <label for="cover">Affiche de couverture</label>
        <div class="cover-dropzone" (click)="fileInput.click()">
          <input
            #fileInput
            type="file"
            id="cover"
            (change)="onCoverSelected($event)"
            accept="image/*"
            hidden />
          <ng-container *ngIf="!coverPreview">
            <p>Cliquez pour choisir un fichier ou glissez-le ici</p>
            <small>PNG / JPG • &lt; 5 Mo</small>
          </ng-container>
          <ng-container *ngIf="coverPreview as url">
            <img [src]="url" alt="Prévisualisation" />
            <button type="button" class="tiny" (click)="coverPreview=null; model.coverFile=null">Retirer</button>
          </ng-container>
        </div>
      </div>

      <!-- Description -->
      <div class="form-field description-col">
        <label for="description">Description</label>
        <textarea id="description" name="description" [(ngModel)]="model.description" rows="10"></textarea>
      </div>
    </div>

    <!-- Auteur / Éditeur -->
    <div class="form-grid">
      <div class="form-field">
        <label for="author">Auteur</label>
        <input id="author" type="text" name="author" [(ngModel)]="model.author" />
      </div>

      <div class="form-field">
        <label for="publisher">Éditeur</label>
        <input id="publisher" type="text" name="publisher" [(ngModel)]="model.publisher" />
      </div>
    </div>

    <!-- ISBN / Date -->
    <div class="form-grid">
      <div class="form-field">
        <label for="isbn">ISBN</label>
        <input id="isbn" type="text" name="isbn" [(ngModel)]="model.isbn" />
      </div>

      <div class="form-field">
        <label for="publicationDate">Date de publication</label>
        <input id="publicationDate" type="date" name="publicationDate" [(ngModel)]="model.publicationDate" />
      </div>
    </div>

    <!-- Genres / Tags -->
    <div class="form-grid">
      <div class="form-field">
        <label for="genres">Genres</label>
        <select id="genres" multiple name="genres" [(ngModel)]="model.genres">
          <option *ngFor="let g of availableGenres" [value]="g">{{ g }}</option>
        </select>
      </div>

      <div class="form-field">
        <label for="tags">Tags</label>
        <input
          id="tags"
          type="text"
          name="tags"
          [(ngModel)]="tagsInput"
          (keyup.enter)="addTag()"
          placeholder="Appuyez sur Entrée pour ajouter un tag" />
        <div class="tag-list">
          <span *ngFor="let t of model.tags" class="tag">
            {{ t }}
            <button type="button" (click)="removeTag(t)">×</button>
          </span>
        </div>
      </div>
    </div>

    <!-- Localisation -->
    <div class="form-grid">
      <div class="form-field">
        <label for="etage">Étage</label>
        <select id="etage" name="etage" [(ngModel)]="model.etage">
          <option *ngFor="let et of etages" [value]="et">{{ et }}</option>
        </select>
      </div>

      <div class="form-field">
        <label for="allee">Allée</label>
        <select id="allee" name="allee" [(ngModel)]="model.allee" (change)="updateRayons()">
          <option *ngFor="let a of allees" [value]="a">{{ a }}</option>
        </select>
      </div>

      <div class="form-field">
        <label for="rayon">Rayon</label>
        <select id="rayon" name="rayon" [(ngModel)]="model.rayon" (change)="updateEtageres()">
          <option *ngFor="let r of rayons" [value]="r">{{ r }}</option>
        </select>
      </div>

      <div class="form-field">
        <label for="etagere">Étagère</label>
        <select id="etagere" name="etagere" [(ngModel)]="model.etagere">
          <option *ngFor="let e of etageres" [value]="e">{{ e }}</option>
        </select>
      </div>
    </div>

    <!-- Bouton submit -->
    <div class="form-actions">
      <button type="submit" class="styled-button">Ajouter le livre</button>
    </div>
  </form>
</div>

